<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>了解微服务架构 - Wallis</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="bomir" />
  <meta name="description" content="P1 - 什么是微服务架构？ Loosely Coupled （松耦合） Service Oriented architecture（基于SOA架构） with bounded Context（有界上下文，局部状态；每个团队可以管理" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.85.0" />


<link rel="canonical" href="https://bomir.github.io/post/microservices-structure/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.b3a8813c06e6d785beba22bf8264e174fa2cb3a396b22f9ba24e2c00c18aaf7f.css" integrity="sha256-s6iBPAbm14W&#43;uiK/gmThdPoss6OWsi&#43;bok4sAMGKr38=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="了解微服务架构" />
<meta property="og:description" content="P1 - 什么是微服务架构？ Loosely Coupled （松耦合） Service Oriented architecture（基于SOA架构） with bounded Context（有界上下文，局部状态；每个团队可以管理" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bomir.github.io/post/microservices-structure/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-09-25T22:19:05+00:00" />
<meta property="article:modified_time" content="2020-09-25T22:19:05+00:00" />

<meta itemprop="name" content="了解微服务架构">
<meta itemprop="description" content="P1 - 什么是微服务架构？ Loosely Coupled （松耦合） Service Oriented architecture（基于SOA架构） with bounded Context（有界上下文，局部状态；每个团队可以管理"><meta itemprop="datePublished" content="2020-09-25T22:19:05+00:00" />
<meta itemprop="dateModified" content="2020-09-25T22:19:05+00:00" />
<meta itemprop="wordCount" content="5284">
<meta itemprop="keywords" content="微服务," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="了解微服务架构"/>
<meta name="twitter:description" content="P1 - 什么是微服务架构？ Loosely Coupled （松耦合） Service Oriented architecture（基于SOA架构） with bounded Context（有界上下文，局部状态；每个团队可以管理"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">秤流沙</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.github.io/">首页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.github.io/about/">关于我</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/Bicomir" rel="noopener" target="_blank">
              Github
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      秤流沙
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.github.io/">首页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.github.io/about/">关于我</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/Bicomir" rel="noopener" target="_blank">
              Github
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">了解微服务架构</h1>
      
      <div class="post-meta">
        <time datetime="2020-09-25" class="post-time">
          2020-09-25
        </time>
        <div class="post-category">
            <a href="https://bomir.github.io/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"> 微服务 </a>
            
          </div>
        <span class="more-meta"> 约 5284 字 </span>
          <span class="more-meta"> 预计阅读 11 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#p1----什么是微服务架构">P1  - 什么是微服务架构？</a></li>
        <li><a href="#p2----如何权衡微服务的利弊">P2  - 如何权衡微服务的利弊？</a></li>
        <li><a href="#p3----康威法则和微服务给予我们怎样的启示"><strong>P3  - 康威法则和微服务给予我们怎样的启示？</strong></a></li>
        <li><a href="#p4----企业应该在什么时候开始考虑引入微服务"><strong>P4  - 企业应该在什么时候开始考虑引入微服务？</strong></a></li>
        <li><a href="#p5---微服务的组织架构"><strong>P5 - 微服务的组织架构</strong></a></li>
        <li><a href="#p6---服务分层"><strong>P6 - 服务分层</strong></a></li>
        <li><a href="#p7---微服务的技术架构体系"><strong>P7 - 微服务的技术架构体系</strong></a></li>
        <li><a href="#p8---微服务的服务发现三种方式"><strong>P8 - 微服务的服务发现三种方式</strong></a></li>
        <li><a href="#p9---微服务网关"><strong>P9 - 微服务网关</strong></a></li>
        <li><a href="#p10---netflix-zuul网关介绍"><strong>P10 - Netflix Zuul网关介绍</strong></a></li>
        <li><a href="#p11---微服务的路由发现体系"><strong>P11 - 微服务的路由发现体系</strong></a></li>
        <li><a href="#p12---微服务配置中心"><strong>P12 - 微服务配置中心</strong></a></li>
        <li><a href="#p13---当rpc遇到了rest">P13 - 当RPC遇到了REST</a></li>
        <li><a href="#p14---服务框架和治理"><strong>P14 - 服务框架和治理</strong></a></li>
        <li><a href="#p15---监控体系"><strong>P15 - 监控体系</strong></a></li>
        <li><a href="#p16----trace调用链监控"><strong>P16 -  Trace调用链监控</strong></a></li>
        <li><a href="#p17---微服务的限流熔断"><strong>P17 - 微服务的限流熔断</strong></a></li>
        <li><a href="#p18---docker-容器部署技术持续交付流水线"><strong>P18 - Docker 容器部署技术&amp;持续交付流水线</strong></a></li>
        <li><a href="#p19---容器调度和发布体系">P19 - 容器调度和发布体系</a></li>
        <li><a href="#p20---微服务案例"><strong>P20 - 微服务案例</strong></a></li>
        <li><a href="#参考博客">参考博客</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h3 id="p1----什么是微服务架构">P1  - 什么是微服务架构？</h3>
<p><a href="https://imgtu.com/i/Wdf6V1"><img src="https://z3.ax1x.com/2021/07/21/Wdf6V1.png" alt="Wdf6V1.png"></a></p>
<p><a href="https://imgtu.com/i/WdfOG8"><img src="https://z3.ax1x.com/2021/07/21/WdfOG8.png" alt="WdfOG8.png"></a></p>
<p>Loosely Coupled （松耦合）</p>
<p>Service Oriented architecture（基于SOA架构）</p>
<p>with <strong>bounded Context</strong>（有界上下文，局部状态；每个团队可以管理自己的数据源，没有集中式的数据管理）</p>
<p><code>Martin Fowler（https://martinfowler.com/）是如此定义微服务的</code></p>
<p><code>“In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running inits own process and communicating with lightweight mechanisms, often an HTTPresource API”</code></p>
<p>微服务框架</p>
<ul>
<li>
<p>一组小的服务（大小没有特别的标准，只要同一团队的工程师理解服务的标识一致即可）</p>
</li>
<li>
<p>独立的进程（java的tomcat，nodejs等）</p>
</li>
<li>
<p>轻量级通信（不是soap，是http协议）</p>
</li>
<li>
<p>基于业务能力（类似用户服务，商品服务等）</p>
</li>
<li>
<p>独立部署（迭代速度快）</p>
</li>
<li>
<p>无集中式管理（无须统一技术栈，可以根据不同的服务或者团队进行灵活选择）</p>
</li>
</ul>
<p>问题：</p>
<p>1.微服务的一个特点是独立部署，那独立部署给我们的微服务，给业务带来什么样的好处？</p>
<p>2.微服务是基于有界上下文，每个团队可以有自己独立的数据源，那么在分布式系统当中又带来什么样的挑战？</p>
<p>ps：微服务的先行者Netflix公司，开源了一些好的微服务框架</p>
<h3 id="p2----如何权衡微服务的利弊">P2  - 如何权衡微服务的利弊？</h3>
<p><strong>利：</strong></p>
<ul>
<li>强模块化边界 。（模块化的演化过程：类&ndash;&gt;组件/类库（sdk）&ndash;&gt;服务(service)，方式越来越灵活）</li>
<li>可独立部署。</li>
<li>技术多样性。</li>
</ul>
<p><strong>弊：</strong></p>
<ul>
<li>分布式复杂性。</li>
<li>最终一致性。（各个服务的团队，数据也是分散式治理，会出现数据不一致的问题）</li>
<li>运维复杂性。</li>
<li>测试复杂性。</li>
</ul>
<p>与单块应用相比不同。</p>
<p>微服务有利也有弊。</p>
<p>问题：</p>
<p>1.微服务对运维来说挑战是非常巨大的，运维团队在面对微服务的复杂性的时候应运用什么样的手段？</p>
<h3 id="p3----康威法则和微服务给予我们怎样的启示"><strong>P3  - 康威法则和微服务给予我们怎样的启示？</strong></h3>
<p>康威法则：</p>
<p>设计系统的企业受限于生产设计，这些设计是企业沟通结构的副本——Melvin Conway(1967)</p>
<p>这意味着设计系统的企业，它们生产的设计等同于企业内的沟通结构。下图说明了此概念：</p>
<p><a href="https://imgtu.com/i/Wdfjxg"><img src="https://z3.ax1x.com/2021/07/21/Wdfjxg.png" alt="Wdfjxg.png"></a></p>
<p>康威法则是微服务的理论基础。</p>
<p>单块应用架构没有组织的概念，效率很低（团队间的沟通效率低）。</p>
<p>问题：</p>
<p>为什么作为架构师，不仅要了解技术架构，也要了解组织的组织架构？</p>
<h3 id="p4----企业应该在什么时候开始考虑引入微服务"><strong>P4  - 企业应该在什么时候开始考虑引入微服务？</strong></h3>
<p>​	从生产力和系统的复杂性这两个方面来看。公司一开始的时候，业务复杂性不高，这时候是验证商业模式的时候，业务简单，用单体服务反而生产力很高。随着公司的发展，业务复杂性慢慢提高，这时候就可以采用微服务来提升生产力了。至于这个转化的点，需要团队的架构师来进行各方面衡量，就个人经验而言，团队发展到百人以上，采用微服务就很有必要了。</p>
<p>​	有些架构师是具有微服务架构能力，所以设计系统时就直接设计成了微服务，而不是通过单服务慢慢演化发展成微服务。在这里我并不推荐这种做法，因为一开始对业务领域并不是很了解，并且业务模式还没有得到验证，这时候上微服务风险比较高，很有可能失败。所以建议大家在单服务的应用成熟时，并且对业务领域比较熟悉的时候，如果发现单服务无法适应业务发展时，再考虑微服务的设计和架构。</p>
<h3 id="p5---微服务的组织架构"><strong>P5 - 微服务的组织架构</strong></h3>
<p><a href="https://imgtu.com/i/WdhSqs"><img src="https://z3.ax1x.com/2021/07/21/WdhSqs.png" alt="WdhSqs.png"></a></p>
<p>传统的企业中，团队是按职能划分的。开发一个项目时，会从不同的职能团队找人进行开发，开发完成后，再各自回到自己的职能团队，这种模式实践证明，效率还是比较低下的。</p>
<p>而如果像右边的，围绕每个业务线或产品，按服务划分团队。团队成员从架构到运维，形成一个完整的闭环。一直围绕在产品周围，进行不断的迭代。不会像传统的团队一样离开。这样开发效率会比较高。至于这种团队的规模，按照亚马逊的两个披萨原则，大概10人左右比较好。</p>
<p>P6 - 如何理解中台战略和微服务</p>
<p><strong>中台战略的由来</strong>：马云2015年去欧洲的一家公司supersell参观，发现这个公司的创新能力非常强，团队的规模很小，但是开发效率很高。他们就是采用中台战略。马云感触很深，回国后就在集团内部推出了中台战略。</p>
<p><a href="https://imgtu.com/i/Wd42cD"><img src="https://z3.ax1x.com/2021/07/21/Wd42cD.png" alt="Wd42cD.png"></a></p>
<p>简单的理解就是把传统的前后台体系中的后台进行了细分。阿里巴巴提出了大中台小前台的战略。就是强化业务和技术中台，把前端的应用变得更小更灵活。当中台越强大，能力就越强，越能更好的快速响应前台的业务需求。打个比喻，就是土壤越肥沃，越适合生长不同的生物，打造好的生态系统。</p>
<h3 id="p6---服务分层"><strong>P6 - 服务分层</strong></h3>
<p>每个公司的服务分层都不相同，有的公司服务没有分层，有的怎分层很多。目前业界没有统一的标准。</p>
<p>下面推荐一个比较容易理解的两层结构。</p>
<p><a href="https://imgtu.com/i/Wd5SNq"><img src="https://z3.ax1x.com/2021/07/21/Wd5SNq.png" alt="Wd5SNq.png"></a></p>
<ul>
<li>
<p>基础服务： 比如一个电商网站，商品服务和订单服务就属于基础服务（核心领域服务）。缓存服务，监控服务，消息队列等也属于基础服务（公共服务）</p>
</li>
<li>
<p>聚合服务 ：例如网关服务就算一种聚合服务（适配服务）。</p>
<p>这是一种逻辑划分，不是物理划分，实际设计的东西很多很复杂。</p>
</li>
</ul>
<h3 id="p7---微服务的技术架构体系"><strong>P7 - 微服务的技术架构体系</strong></h3>
<p>如下是一个成型的互联网微服务的架构体系：</p>
<p><a href="https://imgtu.com/i/Wd5KC6"><img src="https://z3.ax1x.com/2021/07/21/Wd5KC6.png" alt="Wd5KC6.png"></a></p>
<ul>
<li>接入层 负载均衡作用，运维团队负责</li>
<li>网关层 反向路由，安全验证，限流等</li>
<li>业务服务层 基础服务和领域服务</li>
<li>支撑服务层</li>
<li>平台服务</li>
<li>基础设施层 运维团队负责</li>
</ul>
<h3 id="p8---微服务的服务发现三种方式"><strong>P8 - 微服务的服务发现三种方式</strong></h3>
<p>第一种：如下图所示，传统的服务发现（大部分公司的做法）。服务上线后，通知运维，申请域名，配置路由。调用方通过dns域名解析，经过负载均衡路由，进行服务访问。缺点： LB的单点风险，服务穿透LB，性能也不是太好;</p>
<p><a href="https://imgtu.com/i/Wd5N5t"><img src="https://z3.ax1x.com/2021/07/21/Wd5N5t.png" alt="Wd5N5t.png"></a></p>
<p>第二种：也叫客户端发现方式。如下图所示。通过服务注册的方式，服务提供者先注册服务。消费者通过注册中心获取相应服务。</p>
<p>并且把LB的功能移动到了消费者的进程内，消费者根据自身路由去获取相应服务。优点是，没有了LB单点问题，也没有了LB的中间一跳，性能也比较好。但是这种方式有一个非常明显的缺点就是具有非常强的耦合性。针对不同的语言，每个服务的客户端都得实现一套服务发现的功能。</p>
<p><a href="https://imgtu.com/i/Wd5RP0"><img src="https://z3.ax1x.com/2021/07/21/Wd5RP0.png" alt="Wd5RP0.png"></a></p>
<p>第三种：也叫服务端发现方式，如下图所示。和第二种很相似。但是LB功能独立进程单独部署，所以解决了客户端多语言开发的问题。唯一的缺点就是运维成比较高，每个节点都得部署一个LB的代理，例如nginx。</p>
<p><a href="https://imgtu.com/i/Wd5Ir4"><img src="https://z3.ax1x.com/2021/07/21/Wd5Ir4.png" alt="Wd5Ir4.png"></a></p>
<h3 id="p9---微服务网关"><strong>P9 - 微服务网关</strong></h3>
<p>网关就好比一个公司的门卫。屏蔽内部细节，统一对外服务接口。</p>
<p><a href="https://imgtu.com/i/WdoCXF"><img src="https://z3.ax1x.com/2021/07/21/WdoCXF.png" alt="WdoCXF.png"></a></p>
<p>下图是一个网关所处位置的示例图。</p>
<p><a href="https://imgtu.com/i/WdTn5n"><img src="https://z3.ax1x.com/2021/07/21/WdTn5n.png" alt="WdTn5n.png"></a></p>
<h3 id="p10---netflix-zuul网关介绍"><strong>P10 - Netflix Zuul网关介绍</strong></h3>
<p><a href="https://imgtu.com/i/WdHBHe"><img src="https://z3.ax1x.com/2021/07/21/WdHBHe.png" alt="WdHBHe.png"></a></p>
<p>核心就是一个servlet，通过filter机制实现的。主要分为三类过滤器：前置过滤器，过滤器和后置过滤器。</p>
<p>主要特色是，这些过滤器可以动态插拔，就是如果需要增加减少过滤器，可以不用重启，直接生效。原理就是：通过一个db维护过滤器（上图绿色部分），如果增加过滤器，就将新过滤器编译完成后push到db中，有线程会定期扫描db，发现新的过滤器后，会上传到网关的相应文件目录下，并通知过滤器loader进行加载相应的过滤器。</p>
<p><a href="https://imgtu.com/i/WdHfu8"><img src="https://z3.ax1x.com/2021/07/21/WdHfu8.png" alt="WdHfu8.png"></a></p>
<ol>
<li>
<p>请求过来了, 首先会进入一系列的前置过滤器pre filter.</p>
</li>
<li>
<p>前置过滤器处理完了, 进入routing filter路由过滤器, routing filter路由过滤器是真正的向后台服务发起请求, 接收响应的过滤器</p>
</li>
<li>
<p>经过routing filter路由过滤器, 最后会传递过post filter 后置过滤器,进行一些后续的处理, 这时候已经拿到响应了, 然后在返回给客户端.</p>
</li>
<li>
<p>在这三个过滤器过滤的过程中,任何一个环节发生错误, 都会进入error filter. 有error filter进行统一的错误处理. error filter错误过滤器会发送给post filter, 也是以响应的方式发回给客户端.</p>
</li>
</ol>
<p>这是一个请求, 在网关处理的生命周期. 上图从左变http Request开始经过三类过滤器，最终到最右边的Http Response，这就是Zull网关的整个调用流程。</p>
<h3 id="p11---微服务的路由发现体系"><strong>P11 - 微服务的路由发现体系</strong></h3>
<p>整个微服务的路由发现体系，一般由服务注册中心和网关两部分组成。以NetFlix为例子，Eureka和Zull这两个组件支撑了netFlix整个的路由发现体系。如下图所示，首先外部请求发送到网关，网关去服务注册中心获取相应的服务，进行调用。其次内部服务间的调用，也通过服务注册中心进行的。</p>
<p><a href="https://imgtu.com/i/WdHb3q"><img src="https://z3.ax1x.com/2021/07/21/WdHb3q.png" alt="WdHb3q.png"></a></p>
<h3 id="p12---微服务配置中心"><strong>P12 - 微服务配置中心</strong></h3>
<p>目前大部分公司都是把配置写到配置文件中，遇到修改配置的情况，成本很高。并且没有修改配置的记录，出问题很难追溯。配置中心就接解决了以上的问题。</p>
<p>可配置内容：数据库连接，业务参数等等；</p>
<p><a href="https://imgtu.com/i/WdbP81"><img src="https://z3.ax1x.com/2021/07/21/WdbP81.png" alt="WdbP81.png"></a></p>
<p>配置中心就是一个web服务，配置人员通过后台页面修改配置，各个服务就会得到新的配置参数。实现方式主要有两种，一种是push，另一种是pull。两张方式各有优缺点。push实时性较好，但是遇到网络抖动，会丢失消息。pull不会丢失消息但是实时性差一些。大家可以同时两种方式使用，实现一个比较好的效果。如下图所示，这是一个国内知名互联网公司的配置中心架构图。</p>
<p><a href="https://imgtu.com/i/WdbQ2t"><img src="https://z3.ax1x.com/2021/07/21/WdbQ2t.png" alt="WdbQ2t.png"></a></p>
<p>开源地址：http://github.com/ctripcorp/appollo</p>
<h3 id="p13---当rpc遇到了rest">P13 - 当RPC遇到了REST</h3>
<p><a href="https://imgtu.com/i/Wdb0x0"><img src="https://z3.ax1x.com/2021/07/21/Wdb0x0.png" alt="Wdb0x0.png"></a></p>
<p>内部一些核心服务，性能要求比较高的可以采用RPC，对外服务的一般可以采用rest。</p>
<h3 id="p14---服务框架和治理"><strong>P14 - 服务框架和治理</strong></h3>
<p>微服务很多的时候，就需要有治理了。一个好的微服务框架一般分为以下14个部分。如下图所示。这就是开篇所说的，微服务涉及的东西很多，有些初创公司和业务不成熟的产品是不太适合的，成本比较高。</p>
<p>目前国内比较好的微服务框架就是阿里巴巴的DUBBO了,国外的就是spring cloud,大家可以去研究一下.</p>
<p><a href="https://imgtu.com/i/Wdbhxx"><img src="https://z3.ax1x.com/2021/07/21/Wdbhxx.png" alt="Wdbhxx.png"></a></p>
<h3 id="p15---监控体系"><strong>P15 - 监控体系</strong></h3>
<p>监控是微服务治理的重要环节。一般分为以下四层。如下图所示。</p>
<p><a href="https://imgtu.com/i/WdqeyV"><img src="https://z3.ax1x.com/2021/07/21/WdqeyV.png" alt="WdqeyV.png"></a></p>
<p>监控的内容分为五个部分：日志监控，Metrics监控（服务调用情况），调用链监控，告警系统和健康检查。</p>
<p>日志监控，国内常用的就是ELK+KAFKA来实现。健康检查和Metrics，像spring boot会自带。Nagios也是一个很好的开源监控框架。</p>
<h3 id="p16----trace调用链监控"><strong>P16 -  Trace调用链监控</strong></h3>
<p>调用链监控是用来追踪微服务之前依赖的路径和问题定位。例如阿里的鹰眼系统。主要原理就是子节点会记录父节点的id信息。</p>
<p><a href="https://imgtu.com/i/WdqlFJ"><img src="https://z3.ax1x.com/2021/07/21/WdqlFJ.png" alt="WdqlFJ.png"></a></p>
<p>下图是目前比较流行的调用链监控框架。</p>
<p><a href="https://imgtu.com/i/WdqvtJ"><img src="https://z3.ax1x.com/2021/07/21/WdqvtJ.png" alt="WdqvtJ.png"></a></p>
<h3 id="p17---微服务的限流熔断"><strong>P17 - 微服务的限流熔断</strong></h3>
<p>假设服务A依赖服务B和服务C，而B服务和C服务有可能继续依赖其他的服务，继续下去会使得调用链路过长。如果在A的链路上某个或几个被调用的子服务不可用或延迟较高，则会导致调用A服务的请求被堵住，堵住的请求会消耗占用掉系统的线程、io等资源，当该类请求越来越多，占用的计算机资源越来越多的时候，会导致系统瓶颈出现，造成其他的请求同样不可用，最终导致业务系统崩溃。</p>
<p>一般情况对于服务依赖的保护主要有两种方式：熔断和限流。目前最流行的就是Hystrix的熔断框架。</p>
<p><a href="https://imgtu.com/i/WdLoUe"><img src="https://z3.ax1x.com/2021/07/21/WdLoUe.png" alt="WdLoUe.png"></a></p>
<p>限流方式可以采用zuul的API限流方法。</p>
<h3 id="p18---docker-容器部署技术持续交付流水线"><strong>P18 - Docker 容器部署技术&amp;持续交付流水线</strong></h3>
<p>随着微服务的流行，容器技术也相应的被大家重视起来。容器技术主要解决了以下两个问题：</p>
<p>1：环境一致性问题。例如java的jar/war包部署会依赖于环境的问题（操着系统的版本，jdk版本问题）。</p>
<p>2：镜像部署问题。例如java，rubby，nodejs等等的发布系统是不一样的，每个环境都得很麻烦的部署一遍，采用docker镜像，就屏蔽了这类问题。</p>
<p>下图是Docker容器部署的一个完整过程。</p>
<p><a href="https://imgtu.com/i/WdLvb8"><img src="https://z3.ax1x.com/2021/07/21/WdLvb8.png" alt="WdLvb8.png"></a></p>
<p>更重要的是，拥有如此多服务的集群环境迁移、复制也非常轻松，只需选择好各服务对应的Docker服务镜像、配置好相互之间访问地址就能很快搭建出一份完全一样的新集群。</p>
<h3 id="p19---容器调度和发布体系">P19 - 容器调度和发布体系</h3>
<p>目前基于容器的调度平台有Kubernetes，mesos，omega。下图是mesos的一个简单架构示意图。</p>
<p><a href="https://imgtu.com/i/WdOAK0"><img src="https://z3.ax1x.com/2021/07/21/WdOAK0.png" alt="WdOAK0.png"></a></p>
<p>下图是一个完整的容器发布体系：</p>
<p><a href="https://imgtu.com/i/WdOlx1"><img src="https://z3.ax1x.com/2021/07/21/WdOlx1.png" alt="WdOlx1.png"></a></p>
<p>随着持续交付概念推广以及Docker容器普及，微服务将这两种理念和技术结合起来，形成新的微服务+API + 平台的开发模式，提出了容器化微服务的持续交付概念。</p>
<p>微服务促进了DevOps方式的重组，将一个大臃肿的整体产品开发队伍切分为根据不同微服务的划分的产品队伍，以及一个大的整体的平台队伍负责运营管理，两者之间通过API交互，做到了松耦合隔绝。</p>
<p><a href="https://imgtu.com/i/WdXdTU"><img src="https://z3.ax1x.com/2021/07/21/WdXdTU.png" alt="WdXdTU.png"></a></p>
<p>首先需要考虑构建DevOps能力，这是保证微服务架构在持续交付和应对复杂运维问题的动力之源；</p>
<p>其次保持服务持续演进，使之能够快速、低成本地被拆分和合并，以快速响应业务的变化；</p>
<p>同时要保持团队和架构对齐。微服务貌似是技术层面的变革，但它对团队结构和组织文化有很强的要求和影响。识别和构建匹配架构的团队是解决问题的另一大支柱。</p>
<p>最后，打造持续改进的自组织文化是实施微服务的关键基石。只有持续改进，持续学习和反馈，持续打造这样一个文化氛围和团队，微服务架构才能持续发展下去，保持新鲜的生命力，从而实现我们的初衷。</p>
<p>微服务的实施是有一定的先决条件：基础的运维能力（如监控、快速配置、快速部署）需提前构建，否则就会陷入如我们般被动的局面。推荐采用基础设施及代码的实践，通过代码来描述计算和网络基础设施的方法，使得图案度i可以快速安全的搭建和处理由新的配置代替的服务器，服务器之间可以拥有更高的一致性，降低了在“我的环境工作，而你的环境不工作”的可能，也是为后续的发布策略和运维提供更好的支撑。</p>
<p><img src="C:%5CUsers%5Cwjq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1626867340070.png" alt="1626867340070"></p>
<p>由于Docker引入，不同的微服务可以使用不同的技术架构，比如Node.js Java Ruby Python等等，这些单个的服务都可以独立完成交付生命周期，如下：</p>
<p><a href="https://imgtu.com/i/WdjCXq"><img src="https://z3.ax1x.com/2021/07/21/WdjCXq.png" alt="WdjCXq.png"></a></p>
<h3 id="p20---微服务案例"><strong>P20 - 微服务案例</strong></h3>
<p>Netflix的微服务架构如下，着重全球分发 高可扩展性和可用性：</p>
<p><a href="https://imgtu.com/i/WdjKj1"><img src="https://z3.ax1x.com/2021/07/21/WdjKj1.png" alt="WdjKj1.png"></a></p>
<p>Twitter的微服务架构，注重高效的可扩展的数据中心：</p>
<p><a href="https://imgtu.com/i/WdjN3d"><img src="https://z3.ax1x.com/2021/07/21/WdjN3d.png" alt="WdjN3d.png"></a></p>
<h3 id="参考博客">参考博客</h3>
<p><a href="https://www.jianshu.com/p/0a3e959ecb81">https://www.jianshu.com/p/0a3e959ecb81</a></p>
<p><a href="https://www.cnblogs.com/Eternally-dream/p/9849967.html">https://www.cnblogs.com/Eternally-dream/p/9849967.html</a></p>
<p><a href="https://www.cnblogs.com/cjsblog/p/9391819.html">https://www.cnblogs.com/cjsblog/p/9391819.html</a></p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">bomir</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2020-09-25
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://bomir.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/redis-basic1/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">了解redis</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/mysql-ehancement/">
            <span class="next-text nav-default">MySQL优化笔记</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:jinchunw@385@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/Bicomir" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://bomir.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2017 -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        bomir
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="sha256-3uQyMBJ6c9A5pzRRD6iWyJw8fODPC&#43;DHp0M/j9abdtw=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
